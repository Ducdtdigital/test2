$(document).ready(function(){
    /** build trả trước */
    $("#slpercentHD > option, #slpercentPOS > option").each(function() {
        var percent_tt = this.value;
        amount_tt = finalprice*(percent_tt/100);
        amount_tt_f = $.number(amount_tt, 0, ',', '.' );
        $(this).attr("data-prepaid", amount_tt);
        if(percent_tt >= 30){
            $(this).text(percent_tt+'% ('+amount_tt_f+'đ)');
        }

    });
    CalculateInstallment('POS');
});

function CalculateInstallment(idDIV){
    /** Lấy thông tin được chọn */
    var percent_tt   =  $('#slpercent'+idDIV).val();
    var khvay        =  $('#kyhan'+idDIV).val();
    var bank         =  $('#bank').val();
    var card_type    =  $('#card_type').val();
    /* validate */
    if(khvay == 9 && (bank == 1 || bank == 2 || bank == 4)){
        alert('Không hỗ trợ mức kỳ hạn bạn đang chọn');
        return false;
    }
    if(khvay == 3 && bank == 1){
        alert('Không hỗ trợ mức kỳ hạn bạn đang chọn');
        return false;
    }
   if(idDIV == 'POS'){
        if(khvay == 3){
            var feePOS = 2.9;
        }else if(khvay == 6){
            var feePOS = 3.9;
        }else if(khvay == 9){
            var feePOS = bank == 11 ? 7.9 : 4.9;
        }else if(khvay == 12){
            if(bank == 11){
                var feePOS =  8.9;
            }else if(bank == 7 || bank == 9 || bank == 12){
                var feePOS = 6.9;
            }else{
                var feePOS = 5.9;
            }
        }
    }
    /* Tinh toán các giá trị */
    TT         = finalprice*(percent_tt/100);
    NCL        = finalprice - TT;
    Total_fee  = feePOS+parseFloat(card_type);
    amount_fee = finalprice*Total_fee/100;
    gopMT      = (NCL+amount_fee)/khvay;
    TongGop    = TT+NCL+amount_fee;
    cLech      = TongGop-finalprice;
    console.log(TT, NCL, Total_fee, amount_fee);

    Goc_Lai  = $.number(gopMT, 0, ',', '.' );
    gopMTf   = $.number(gopMT, 0, ',', '.' );
    TongGopf = $.number(TongGop, 0, ',', '.' );
    cLechf   = $.number(cLech, 0, ',', '.' );
    /* Xuất thông tin cho người xem */

    $('#gopMT'+idDIV).text(gopMTf+'₫');
    $('#goc'+idDIV).text(Goc_Lai+'₫');
    $('#Total'+idDIV).text(TongGopf+'₫');
    $('#lech'+idDIV).text(cLechf+'₫');
    $('#ls'+idDIV).text(Total_fee+'%');
    $('#mounth'+idDIV).text(khvay);

}